/* empty css                  *//* empty css                  */import"./el-form-item-l0sNRNKZ.js";import{G as x,d as B,s as K,t as A,v as q,c as I,x as M,o as y,a as k,w as a,H as X,g,f as e,h as m,i as o,C as $,I as F,z as G,D as H,j as N,y as C,J as U,K as S,L as O,M as W,N as z,O as Q,P as j,Q as J,S as Z,T as ee,U as R,q as le,r as te,V as P,W as ae,X as oe}from"./index-CpmgyURR.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";function se(){return x({url:"/certificate/list",method:"post"})}function ue(u){return x({url:"/certificate/add",method:"post",data:u})}function de(u){return x({url:"/certificate/cancel",method:"post",data:u})}function re(){return x({url:"/certificate/sync",method:"post"})}const ie=g("div",{class:"dialog-header"},[g("div",{class:"dialog-header-title"},"创建证书")],-1),ce={class:"dialog-footer"},pe=B({__name:"CertificateAddDialog",props:{modelValue:{type:Boolean,default:!1},domain:{}},emits:["update:modelValue","success"],setup(u,{emit:v}){const V=K($),f=u,r=A({formData:{},rules:{domain:[{required:!0,message:"请输入域名",trigger:["blur","change"]}]}}),{formData:n,rules:h}=q(r),i=v,s=I({get:()=>f.modelValue,set:d=>{i("update:modelValue",d)}});M(()=>f.modelValue,async d=>{d?setTimeout(()=>{V.value.clearValidate()},200):r.formData={}});const c=()=>{i("update:modelValue",!1)},D=()=>{V.value.validate(async d=>{d&&(await ue(r.formData),F.success("成功"),i("update:modelValue",!1),i("success"))})};return(d,t)=>{const p=G,_=H,w=N,b=X;return y(),k(b,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=E=>s.value=E),width:"500px","close-icon":"CircleClose"},{header:a(()=>[ie]),footer:a(()=>[g("span",ce,[e(w,{onClick:c},{default:a(()=>[m("取消")]),_:1}),e(w,{type:"primary",onClick:D},{default:a(()=>[m("确认")]),_:1})])]),default:a(()=>[e(o($),{ref_key:"dataFormRef",ref:V,model:o(n),rules:o(h),"label-width":"80px"},{default:a(()=>[e(_,{prop:"domain",label:"域名"},{default:a(()=>[e(p,{modelValue:o(n).domain,"onUpdate:modelValue":t[0]||(t[0]=E=>o(n).domain=E)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),me=B({__name:"CertificateTypeSelect",props:{modelValue:{},showText:{type:Boolean,default:!1},width:{default:"100%"}},emits:["update:modelValue"],setup(u,{emit:v}){const V=[{label:"DV 类型的证书",value:"DV"},{label:"EV 类型的证书",value:"EV"},{label:"OV 类型的证书",value:"OV"},{label:"免费证书",value:"FREE"}],f=u,r=v,n=I({get:()=>f.modelValue,set:s=>{r("update:modelValue",s)}}),h=I(()=>{const s=V.find(c=>c.value===f.modelValue);return s?s.label:""}),i=()=>{r("update:modelValue",void 0)};return(s,c)=>{const D=Q,d=z;return s.showText?(y(),C(S,{key:0},[m(U(h.value),1)],64)):(y(),k(d,{key:1,modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=t=>n.value=t),style:W({width:s.width}),onClear:i,clearable:""},{default:a(()=>[(y(),C(S,null,O(V,t=>e(D,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","style"]))}}}),fe=B({__name:"CertificateStatusSelect",props:{modelValue:{},showText:{type:Boolean,default:!1},width:{default:"100%"}},emits:["update:modelValue"],setup(u,{emit:v}){const V=[{label:"待申请",value:"PAYED"},{label:"审核中",value:"CHECKING"},{label:"审核失败",value:"CHECKED_FAIL"},{label:"已签发",value:"ISSUED"},{label:"即将过期",value:"WILLEXPIRED"},{label:"已过期",value:"EXPIRED"},{label:"未激活",value:"NOTACTIVATED"},{label:"吊销完成",value:"REVOKED"}],f=u,r=v,n=I({get:()=>f.modelValue,set:s=>{r("update:modelValue",s)}}),h=I(()=>{const s=V.find(c=>c.value===f.modelValue);return s?s.label:""}),i=()=>{r("update:modelValue",void 0)};return(s,c)=>{const D=Q,d=z;return s.showText?(y(),C(S,{key:0},[m(U(h.value),1)],64)):(y(),k(d,{key:1,modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=t=>n.value=t),style:W({width:s.width}),onClear:i,clearable:""},{default:a(()=>[(y(),C(S,null,O(V,t=>e(D,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","style"]))}}});function _e(u){return x({url:"certificate/deploy/detail",method:"post",data:u})}function ye(u){return x({url:"certificate/deploy/add",method:"post",data:u})}function Ve(u){return x({url:"certificate/deploy/deploy",method:"post",data:u})}const ge=g("div",{class:"dialog-header"},[g("div",{class:"dialog-header-title"},"配置")],-1),ve=g("h4",null,"域名",-1),be=g("h4",null,"服务器连接配置",-1),he=g("h4",null,"到期自动更新开关",-1),we={class:"dialog-footer"},De=B({__name:"CertificateDeployDialog",props:{modelValue:{type:Boolean,default:!1},domain:{default:""}},emits:["update:modelValue","success"],setup(u,{emit:v}){const V=K($),f=u,r=A({formData:{},rules:{host:[{required:!0,message:"请输入主机ip",trigger:["blur","change"]}],port:[{required:!0,message:"请输入端口号",trigger:["blur","change"]}],username:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}],path:[{required:!0,message:"请输入证书路径",trigger:["blur","change"]}],cronStatus:[{required:!0,message:"请输入选择开关状态",trigger:["blur","change"]}]}}),{formData:n,rules:h}=q(r),i=v,s=I({get:()=>f.modelValue,set:d=>{i("update:modelValue",d)}});M(()=>f.modelValue,async d=>{if(d){const{data:t}=await _e({domain:f.domain});t?r.formData=t:r.formData={},V.value.clearValidate()}else r.formData={}});const c=()=>{i("update:modelValue",!1)},D=()=>{V.value.validate(async d=>{d&&(r.formData.domain=f.domain,await ye(r.formData),F.success("成功"),i("update:modelValue",!1),i("success"))})};return(d,t)=>{const p=G,_=H,w=j,b=J,E=N,L=X;return y(),k(L,{modelValue:s.value,"onUpdate:modelValue":t[7]||(t[7]=l=>s.value=l),width:"500px","close-icon":"CircleClose"},{header:a(()=>[ge]),footer:a(()=>[g("span",we,[e(E,{onClick:c},{default:a(()=>[m("取消")]),_:1}),e(E,{type:"primary",onClick:D},{default:a(()=>[m("确认")]),_:1})])]),default:a(()=>[e(o($),{ref_key:"dataFormRef",ref:V,model:o(n),rules:o(h),"label-width":"80px"},{default:a(()=>[ve,m(" "+U(f.domain)+" ",1),be,e(_,{prop:"host",label:"host"},{default:a(()=>[e(p,{modelValue:o(n).host,"onUpdate:modelValue":t[0]||(t[0]=l=>o(n).host=l)},null,8,["modelValue"])]),_:1}),e(_,{prop:"port",label:"port"},{default:a(()=>[e(p,{modelValue:o(n).port,"onUpdate:modelValue":t[1]||(t[1]=l=>o(n).port=l)},null,8,["modelValue"])]),_:1}),e(_,{prop:"username",label:"用户名"},{default:a(()=>[e(p,{modelValue:o(n).username,"onUpdate:modelValue":t[2]||(t[2]=l=>o(n).username=l)},null,8,["modelValue"])]),_:1}),e(_,{prop:"password",label:"密码"},{default:a(()=>[e(p,{modelValue:o(n).password,"onUpdate:modelValue":t[3]||(t[3]=l=>o(n).password=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(_,{prop:"path",label:"证书路径"},{default:a(()=>[e(p,{modelValue:o(n).path,"onUpdate:modelValue":t[4]||(t[4]=l=>o(n).path=l)},null,8,["modelValue"])]),_:1}),e(_,{prop:"shell",label:"执行脚本"},{default:a(()=>[e(p,{modelValue:o(n).shell,"onUpdate:modelValue":t[5]||(t[5]=l=>o(n).shell=l),placeholder:"例如：docker restart nginx"},null,8,["modelValue"])]),_:1}),he,e(_,{prop:"cronStatus"},{default:a(()=>[e(b,{modelValue:o(n).cronStatus,"onUpdate:modelValue":t[6]||(t[6]=l=>o(n).cronStatus=l)},{default:a(()=>[e(w,{label:"ON"},{default:a(()=>[m("开启")]),_:1}),e(w,{label:"OFF"},{default:a(()=>[m("关闭")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),Y=u=>(le("data-v-92d97923"),u=u(),te(),u),Ce=Y(()=>g("h2",null,"证书列表",-1)),Ee=Y(()=>g("div",{class:"tip custom-block"},[g("p",{class:"custom-block-title"},"TIP"),g("p",null,"域名要在阿里云平台，因为后面的验证需要添加一条txt类型的解析记录。创建证书后就可以配置部署信息，开启到期自动更新开关，证书申请成功后会自动部署。"),g("p",null,"初次创建证书自动处理过程。1.请求阿里云申请证书。2.域名添加一条txt类型的记录。3.申请证书成功。4.根据部署配置上传证书文件。")],-1)),ke={style:{display:"flex",height:"50px"}},Se=B({__name:"index",setup(u){const v=A({syncing:!1,dataList:[],curData:{},deployDialog:{},certificateAddDialog:{}}),{syncing:V,dataList:f,curData:r,deployDialog:n,certificateAddDialog:h}=q(v),i=async()=>{v.syncing=!0;try{await re(),await c()}finally{v.syncing=!1}},s=()=>{i(),setTimeout(()=>{i()},5e3)},c=async()=>{const{data:p}=await se();v.dataList=p},D=p=>{v.curData=p,v.deployDialog.visible=!0},d=async p=>{P.confirm("确认部署吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Ve({domain:p.domain}),await c(),F({type:"success",message:"部署成功"})}).catch(()=>{})},t=p=>{P.confirm("确认取消吗?待申请状态可去阿里云后台继续申请证书，或者取消后在本系统重新申请","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await de({instanceId:p.instanceId}),F({type:"success",message:"取消成功"})}finally{await i()}}).catch(()=>{})};return Z(()=>{c()}),(p,_)=>{const w=N,b=ae,E=oe,L=ee;return y(),C("div",null,[Ce,Ee,g("div",ke,[e(w,{type:"primary",onClick:i,loading:o(V)},{default:a(()=>[m("同步阿里云")]),_:1},8,["loading"]),e(w,{type:"primary",onClick:_[0]||(_[0]=l=>o(h).visible=!0)},{default:a(()=>[m("创建证书")]),_:1})]),e(L,{data:o(f)},{default:a(()=>[e(b,{prop:"instanceId",label:"资源ID"}),e(b,{prop:"certType",label:"品牌"},{default:a(l=>[e(me,{"model-value":l.row.certType,"show-text":""},null,8,["model-value"])]),_:1}),e(b,{prop:"status",label:"状态"},{default:a(l=>[e(fe,{"model-value":l.row.status,"show-text":""},null,8,["model-value"])]),_:1}),e(b,{prop:"sans",label:"绑定域名"},{default:a(l=>[l.row.sans?(y(!0),C(S,{key:0},O(l.row.sans.split(","),T=>(y(),C("p",{key:T},U(T),1))),128)):(y(),C(S,{key:1},[m(U(l.row.domain),1)],64))]),_:1}),e(b,{prop:"deployStatus",label:"部署结果"},{default:a(l=>[l.row.deployStatus==="SUCCESS"?(y(),C(S,{key:0},[m(" 成功 ")],64)):l.row.deployStatus==="FAIL"?(y(),k(E,{key:1,placement:"top-start",title:"失败原因",width:200,trigger:"hover",content:l.row.deployError},{reference:a(()=>[m(" 失败 ")]),_:2},1032,["content"])):R("",!0)]),_:1}),e(b,{prop:"deployDate",label:"部署时间"}),e(b,{prop:"nextDeployDate",label:"下次部署"}),e(b,{prop:"endDate",label:"有效期限"}),e(b,{prop:"cronStatus",label:"到期更新"}),e(b,{label:"操作"},{default:a(l=>[e(w,{type:"primary",link:"",onClick:T=>D(l.row)},{default:a(()=>[m("配置")]),_:2},1032,["onClick"]),l.row.status==="PAYED"?(y(),k(w,{key:0,type:"primary",link:"",onClick:T=>t(l.row)},{default:a(()=>[m("取消")]),_:2},1032,["onClick"])):R("",!0),l.row.status==="ISSUED"||l.row.status==="WILLEXPIRED"?(y(),k(w,{key:1,type:"primary",link:"",onClick:T=>d(l.row)},{default:a(()=>[m("部署")]),_:2},1032,["onClick"])):R("",!0)]),_:1})]),_:1},8,["data"]),e(De,{modelValue:o(n).visible,"onUpdate:modelValue":_[1]||(_[1]=l=>o(n).visible=l),domain:o(r).domain,onSuccess:c},null,8,["modelValue","domain"]),e(pe,{modelValue:o(h).visible,"onUpdate:modelValue":_[2]||(_[2]=l=>o(h).visible=l),onSuccess:s},null,8,["modelValue"])])}}}),$e=ne(Se,[["__scopeId","data-v-92d97923"]]);export{$e as default};
